<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magic Connect</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
<!-- خط Montserrat -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Cairo', sans-serif;
        background: #0f0f0f;
        color: #fff;
        margin: 0;
        padding: 0;
    }

    /* الهيدر المعدل */
    header {
        position: sticky;
        top: 0;
        z-index: 999;
        background: linear-gradient(to left, #333, #333);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        
        margin-bottom: 10px;
    }

    header i {
        font-size: 20px;
        cursor: pointer;
    }

    header h1 {
        margin: 0;
        font-size: 20px;
        font-family: 'Montserrat', sans-serif;
    }

    .header-buttons {
        background: none;
      border: none;
      color: var(--light);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.15);
    }

    .header-buttons a {
        color: white;
        font-size: 22px;
        text-decoration: none;
        transition: color 0.3s;
    }

    .header-buttons a:hover {
        color: #cfd8dc;
    }

    /* قائمة الأخبار */
    .news-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
        padding: 10px;
        box-sizing: border-box;
    }

    .news-card {
        background: #272727;
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        border: 1px solid #666;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    /* إزالة تأثير التركيز التلقائي والتركيز الأزرق */
    .news-card:focus,
    .news-card:focus-visible {
        outline: none;
        border-color: #666;
        box-shadow: none;
    }

    .news-card:hover {
        border-color: #666;
        
    }

    .news-card.active {
        border-color: #666;
        
    }

    .news-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        display: block;
    }

    .news-card .content {
        padding: 10px;
    }

    .news-card h3 {
        font-weight: 700;
        color: #fff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin: 0;
        font-size: 16px;
    }

    .news-card p {
        color: rgba(255,255,255,0.6);
        font-size: 14px;
        margin-top: 8px;
        line-height: 1.5;
    }

    /* تغيير لون وقت الخبر إلى ذهبي غامق */
    .news-time {
        font-size: 12px;
        color: #B8860B; /* ذهبي غامق احترافي */
        margin-top: 10px;
        display: block;
        font-weight: bold;
    }

    /* تفاصيل الخبر */
    .news-details {
        display: none;
        padding: 20px;
        max-width: 900px;
        margin: auto;
        position: relative;
    }

    .back-btn {
        background: linear-gradient(135deg, #222, #444, #222);
        border: none;
        color: #fff;
        font-weight: 700;
        font-family: 'Cairo', sans-serif;
        padding: 10px 20px;
        margin-bottom: 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
        transition: background 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: fit-content;
    }

    
    

    .news-details img {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 15px;
        display: block;
    }

    .news-details h2 {
        color: #f0f0f0;
        margin-bottom: 10px;
    }

    .news-details p {
        line-height: 1.8;
        color: #ccc;
        font-size: 15px;
        white-space: pre-line;
    }

    /* لودر */
    .loader {
        text-align: center;
        padding: 15px;
        color: #aaa;
        font-size: 14px;
        display: none;
    }

    .dot {
        height: 10px;
        width: 10px;
        margin: 0 3px;
        background-color: #aaa;
        border-radius: 50%;
        display: inline-block;
        animation: bounce 0.6s infinite alternate;
    }

    .dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes bounce {
        to { transform: translateY(-5px); opacity: 0.5; }
    }

    /* شاشة التحميل الأولي */
    #splashScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #000000, #001a11);
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .pure-loader {
        width: 60px;
        height: 60px;
        border: 6px solid #444;
        border-top: 6px solid #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .rotate {
        animation: spin 0.6s linear;
    }

    /* قائمة النقاط الثلاثة - معدلة */
    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropdown-content {
        display: none;
        position: fixed;
        top: 60px;
        right: 15px;
        background-color: #333;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1000;
        border-radius: 8px;
        overflow: hidden;
    }

    .dropdown-content a {
        color: #fff;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    .dropdown-content a:hover {
        background-color: #444;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    /* إخفاء القائمة عند عرض تفاصيل الخبر */
    .news-details-showing .dropdown-content {
        display: none !important;
    }
    
    .back-btn i {
        margin-right: 8px;
        font-weight: bold;
    }
    
    /* زر الصعود لأعلى */
    .scroll-to-top {
        position: fixed;
        bottom: 30px;
        left: 30px; /* تغيير من right إلى left ليتناسب مع RTL */
        background: linear-gradient(to left, #333, #333);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        z-index: 99;
        opacity: 0;
        transition: opacity 0.3s;
        border: 1px solid #555;
    }
    
    .scroll-to-top.visible {
        opacity: 1;
    }
    
    .scroll-to-top i {
        color: white;
        font-size: 20px;
    }
    
    /* إزالة تأثير التحويل عند التركيز */
    .news-card:focus {
        transform: none;
    }
    
    /* إزالة التركيز الأزرق من جميع العناصر عند النقر */
    *:focus {
        outline: none !important;
    }
    
    /* إضافة تأثير بديل للتركيز للوصولية */
    .news-card:focus-visible {
        box-shadow: 0 0 0 3px rgba(128, 128, 128, 0.7) !important;
    }
    
    button:focus-visible {
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5) !important;
    }
</style>
</head>
<body>


<!-- الهيدر المعدل -->
<header>
    <div class="header-buttons">
      <span id="refreshIcon" class="refresh-icon"><i class="fa fa-refresh"></i></span>
    </div>
    <h1>Magic Connect</h1>
    <div class="header-buttons">
      <a href="go:services"><i class="fas fa-arrow-left"></i></a>
    </div>
  </header>

<!-- قائمة الأخبار -->
<div class="news-container" id="newsContainer"></div>

<!-- لودر -->
<div class="loader" id="loader">
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
</div>

<!-- تفاصيل الخبر -->
<div class="news-details" id="newsDetails">
    <button class="back-btn" id="backButton" tabindex="0">العودة للأخبار  <i class="fas fa-arrow-left" style="font-weight:bold"></i></button>
    <h2 id="detailTitle"></h2>
    <img id="detailImage" src="" alt="">
    <p id="detailContent"></p>
    <!-- تغيير لون وقت الخبر في صفحة التفاصيل أيضا -->
    <span class="news-time" id="detailTime"></span>
</div>

<!-- زر الصعود لأعلى -->
<div class="scroll-to-top" id="scrollToTop">
    <i class="fas fa-arrow-up"></i>
</div>

<script>
let currentPage = 1;
let isLoading = false;
let hasMore = true;
let currentFocusedIndex = 0;
let newsCards = [];

const BASE_API = "https://ko.best-goal.live/news.php?page=";
const newsContainer = document.getElementById('newsContainer');
const newsDetails = document.getElementById('newsDetails');
const loader = document.getElementById('loader');
const body = document.body;
const backButton = document.getElementById('backButton');
const scrollToTop = document.getElementById('scrollToTop');

async function fetchNews(page) {
    if (isLoading || !hasMore) return;
    isLoading = true;
    loader.style.display = "block";
    try {
        const res = await fetch("https://corsproxy.io/?" + encodeURIComponent(BASE_API + page));
        const data = await res.json();
        if (!data || data.length === 0) {
            hasMore = false;
        } else {
            renderNews(data);
            currentPage++;
            
            // تم إزالة التركيز التلقائي على البطاقة الأولى
        }
    } catch (err) {
        console.error("خطأ في جلب الأخبار:", err);
    }
    loader.style.display = "none";
    isLoading = false;
}

function renderNews(news) {
    const fragment = document.createDocumentFragment();
    news.forEach(item => {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.tabIndex = 0; // لجعل العنصر قابلاً للتركيز
        card.innerHTML = `
            <img src="${item.image}" alt="${item.title}" loading="lazy">
            <div class="content">
                <h3>${item.title}</h3>
                <p>${item.sub_link || ''}</p>
                <span class="news-time">${item.time || ''}</span>
            </div>
        `;
        card.addEventListener('click', () => showDetails(item));
        card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                showDetails(item);
            }
        });
        
        // إضافة حدث التركيز لإزالة التركيز من البطاقات الأخرى
        card.addEventListener('focus', () => {
            removeActiveClassFromAllCards();
            card.classList.add('active');
            updateCurrentFocusedIndex(card);
        });
        
        // إضافة حدث hover لإزالة التركيز من البطاقات الأخرى
        card.addEventListener('mouseenter', () => {
            removeActiveClassFromAllCards();
            card.classList.add('active');
            updateCurrentFocusedIndex(card);
        });
        
        // منع ظهور التركيز الأزرق عند النقر
        card.addEventListener('mousedown', (e) => {
            e.preventDefault();
        });
        
        fragment.appendChild(card);
    });
    newsContainer.appendChild(fragment);
}

// إزالة فئة active من جميع البطاقات
function removeActiveClassFromAllCards() {
    document.querySelectorAll('.news-card').forEach(c => {
        c.classList.remove('active');
    });
}

// تحديث الفهرس الحالي للبطاقة المركز عليها
function updateCurrentFocusedIndex(card) {
    const cards = Array.from(document.querySelectorAll('.news-card'));
    currentFocusedIndex = cards.indexOf(card);
}

function showDetails(item) {
    body.classList.add('news-details-showing');
    
    document.getElementById('detailTitle').innerText = item.title;
    document.getElementById('detailImage').src = item.image;
    document.getElementById('detailContent').innerHTML = item.content || '';
    document.getElementById('detailTime').innerText = item.time || '';
    newsContainer.style.display = "none";
    loader.style.display = "none";
    newsDetails.style.display = "block";
    
    // إظهار زر الصعود لأعلى في صفحة التفاصيل
    scrollToTop.classList.add('visible');
    
    // التركيز على زر العودة عند فتح التفاصيل
    setTimeout(() => {
        backButton.focus();
    }, 100);
}

function showNewsList() {
    body.classList.remove('news-details-showing');
    
    newsDetails.style.display = "none";
    newsContainer.style.display = "grid";
    
    // إخفاء زر الصعود لأعلى في صفحة الأخبار الرئيسية
    scrollToTop.classList.remove('visible');
    
    // عند العودة، نعيد التركيز على الخبر الذي كان مفعلاً
    setTimeout(() => {
        if (newsCards.length > currentFocusedIndex) {
            newsCards[currentFocusedIndex].focus();
            newsCards[currentFocusedIndex].classList.add('active');
        }
    }, 100);
}

// التنقل بين الأخبار باستخدام لوحة المفاتيح
document.addEventListener('keydown', (e) => {
    if (body.classList.contains('news-details-showing')) {
        // في صفحة التفاصيل، نتحقق من ضغط زر العودة
        if (e.key === 'Backspace' || e.key === 'Escape') {
            showNewsList();
        }
        return;
    }
    
    if (newsCards.length === 0) return;
    
    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
        e.preventDefault();
        moveFocus(1);
    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
        e.preventDefault();
        moveFocus(-1);
    }
});

function moveFocus(direction) {
    if (newsCards.length === 0) return;
    
    // إزالة التركيز من العنصر الحالي
    newsCards[currentFocusedIndex].classList.remove('active');
    
    // حساب المؤشر الجديد
    currentFocusedIndex += direction;
    
    // التأكد من أن المؤشر ضمن الحدود
    if (currentFocusedIndex < 0) {
        currentFocusedIndex = newsCards.length - 1;
    } else if (currentFocusedIndex >= newsCards.length) {
        currentFocusedIndex = 0;
    }
    
    // تطبيق التركيز على العنصر الجديد
    newsCards[currentFocusedIndex].classList.add('active');
    newsCards[currentFocusedIndex].focus();
    
    // التمرير لرؤية العنصر إن كان خارج الشاشة
    newsCards[currentFocusedIndex].scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
    });
}

// التحكم في زر الصعود لأعلى
window.addEventListener('scroll', () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
        fetchNews(currentPage);
    }
    
    // إظهار أو إخفاء زر الصعود لأعلى
    if (window.pageYOffset > 300) {
        scrollToTop.classList.add('visible');
    } else {
        scrollToTop.classList.remove('visible');
    }
});

// حدث النقر على زر الصعود لأعلى
scrollToTop.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
});

// تحميل الأخبار الأولية
fetchNews(currentPage);


// زر التحديث
document.getElementById("refreshIcon").addEventListener("click", function () {
    const icon = this.querySelector("i");
    icon.classList.add("rotate");
    setTimeout(() => {
        icon.classList.remove("rotate");
        // إعادة تحميل الأخبار
        currentPage = 1;
        hasMore = true;
        newsContainer.innerHTML = '';
        fetchNews(currentPage);
    }, 600);
});

// حدث التركيز على زر العودة
backButton.addEventListener('click', showNewsList);
backButton.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        showNewsList();
    }
});

// إمكانية العودة باستخدام زر Backspace أو Escape
document.addEventListener('keydown', (e) => {
    if ((e.key === 'Backspace' || e.key === 'Escape') && body.classList.contains('news-details-showing')) {
        showNewsList();
    }
});

// تحديث قائمة newsCards عند إضافة بطاقات جديدة
const observer = new MutationObserver(() => {
    newsCards = document.querySelectorAll('.news-card');
});

observer.observe(newsContainer, {
    childList: true,
    subtree: true
});
</script>

</body>
</html>